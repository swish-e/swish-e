# 
# Makefile derived from the Makefile coming with swish-e 1.3.2
# (original Makefile for SWISH Kevin Hughes, 3/12/95)
#
# The code has been tested to compile on Solaris and DEC 
# G.Hill ghill@library.berkeley.edu 6/11/97
# 
# autoconf configuration by Bas Meijer, 11 Dec 2000
# Cross Platform Compilation on Solaris, HP-UX, IRIX, Mac OS X, BDSi and Linux
# Several ideas from a Makefile by Christian Lindig <lindig@ips.cs.tu-bs.de>  
#
# $Id$

# get name and version from configure.in
NAME        = @PROJECT@
VERSION     = @VERSION@

# C compiler
CC          = @CC@

SHELL       = /bin/sh
prefix      = @prefix@
bindir      = $(prefix)/bin
exec_prefix = @exec_prefix@
libdir      = @libdir@

# Flags for C compiler
CFLAGS      = -Wall @CFLAGS@ @DEFS@ -DSWISH_VERSION=\"$(VERSION)\"


LIBS        = @LIBS@

# Library related 
AR          = ar
ARFLAGS     = cr
RANLIB      = @RANLIB@

#
# The objects for the different methods and
# some common aliases
#

FILESYSTEM_OBJS=fs.o
HTTP_OBJS   =http.o httpserver.o 
FS_OBJS     =$(FILESYSTEM_OBJS)
WEB_OBJS    =$(HTTP_OBJS)

OBJS=	check.o file.o index.o search.o error.o methods.o\
	hash.o list.o mem.o string.o merge.o swish2.o stemmer.o \
	soundex.o docprop.o compress.o deflate.o xml.o txt.o html.o\
	metanames.o result_output.o parse_conffile.o result_sort.o\
	filter.o lst.o search_alt.o keychar_out.o date_time.o \
	extprog.o entities.o \
	$(FILESYSTEM_OBJS) $(HTTP_OBJS)

.SUFFIXES: 
.SUFFIXES : .o .c
.c.o :
	$(CC) $(CFLAGS) -c $<

.SUFFIXES : .a .c
.c.a :
	$(CC) $(CFLAGS) -c $<
	$(AR) $(ARFLAGS) $@ $*.o

all:	$(NAME) swish-search testlib

$(NAME): $(OBJS) libswish-e.a swish.o
	$(CC) -o $@ $(CFLAGS) swish.o libswish-e.a $(LIBS)
	chmod 755 $@

testlib: testlib.o libswish-e.a swish.o
	$(CC) -o testlib $(CFLAGS) testlib.o libswish-e.a $(LIBS)
	chmod 755 $@

libswish-e.a: $(OBJS)
	$(AR) $(ARFLAGS) libswish-e.a $(OBJS)
	$(RANLIB) libswish-e.a

swish-search: $(NAME)
	cp -f $(NAME) swish-search

clean:
	rm -f ../tests/*.index ../tests/core ./core ./testlib ./swish-e ./swish-search ./*.o ./index.swish ./libswish-e.a

realclean: clean
	rm Makefile
	rm -f config.cache config.log config.status

test:	$(NAME)
	@echo -e "\nCreating index..."
	@(cd ../tests; ../src/swish-e -c test.config)

	@echo -e "\n** Five (5) tests follow..."

	@echo -e "\ntest 1 (Normal search) ..."
	@(cd ../tests; ../src/swish-e -f ./test.index -w test | egrep  '^[0-9]')
	
	@echo -e "\ntest 2 (MetaTag search 1) ..."
	@(cd ../tests; ../src/swish-e -f ./test.index -w meta1=metatest1 | egrep  '^[0-9]')
	
	@echo -e "\ntest 3 (MetaTag search 2) ..."
	@(cd ../tests; ../src/swish-e -f ./test.index -w meta2=metatest2 | egrep  '^[0-9]')
	
	@echo -e "\ntest 4 (XML search) ..."
	@(cd ../tests; ../src/swish-e -f ./test.index -w meta3=metatest3 | egrep  '^[0-9]')
	
	@echo -e "\ntest 5 (Phrase search) ..."
	@(cd ../tests; ../src/swish-e -f ./test.index -w '"three little pigs"' | egrep  '^[0-9]')

	@echo -e "\n ** All tests completed! **\n"


$(OBJS):	Makefile config.h swish.h

install:
	cp swish-e $(bindir)/swish-e

install-lib:	
	cp libswish-e.a $(libdir)/libswish-e.a


#
# dependencies
# 
*.o: *.h

*.c: *.h



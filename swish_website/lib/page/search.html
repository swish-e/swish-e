[%- # $id$
    # Page for shwoing search results
-%]


<div class="search-page">
[%-

    page.title = 'Search';


    MACRO message(text) BLOCK;
        '<div class="search-message">';
        text;
        '</div>';
        page.title = text | html;
    END;

    USE myurl = url( request.myself, query=request.query, 
                     metaname=request.metaname, size=request.pagesize );

    USE result_date = Date;  # set date format for results


    UNLESS result;
        message( "Must enter a query" );
    ELSE;

        # Show results

        message( result.message ) IF result.message;

        IF result.results.size;

            SET query_html = request.query | html;
            page.title = "[$query_html] $result.results.size results";
            PROCESS results_header;
            PROCESS next_links;
            PROCESS display_results;
            PROCESS next_links;
        ELSE;
            message( "No Results Found" );
        END;
    END;
-%]
</div>



[% BLOCK display_results %]
    <div class="search-results">

    [% FOREACH item = result.results %]
        <div class="search-result">
            [% PROCESS show_result %]
        </div>
    [% END %]
    </div>
[% END %]



[% BLOCK results_header %]
<div class="search-header">
    Results for <b>[% request.query | html %]</b><br>
    Showing page [% result.page %] 
    ([% result.start +1 %] - [% (result.start + result.shown) %] of [% result.hits %] hits) 

</div>
[% END %]




[% BLOCK next_links %]
    [% IF result.prev %]
       <a class="next" href="[% myurl( page=result.prev ) %]">Previous</a>
    [% END %]
    [% IF result.next %]
       <a class="prev" href="[% myurl( page=result.next ) %]">Next</a> 
    [% END %]
[% END %]


[% BLOCK show_result %]

    <div class="search-title">
        <a href="[% item.Property('swishdocpath') | uri | html %]">
            [%  item.Property('swishtitle') || 'missing title' | highlight('swishtitle', item ) %]</a>

        <span class="search-rank"> -- rank: <b>[% item.Property('swishrank') %]</b></span>
    </div>

    <div class="search-description">
        [% item.Property('swishdescription') || "No description" | highlight('swishdescription', item) %]
    </div>

    <div class="search-metadata">
        Path: <a href="[% item.Property('swishdocpath') | uri | html %]">
            [% item.Property('swishdocpath') | highlight('swishdocpath', item ) %]</a>
            - [% item.Property('swishdocsize') %] bytes<br>
        Date: [% result_date.format( item.Property('swishlastmodified')) %]<br>
    </div>
[% END %]


